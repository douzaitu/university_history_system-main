<!DOCTYPE html>
<html>
  <head>
    <title>æ ¡å²ç®¡ç†é¢æ¿</title>
    <meta charset="utf-8" />
    <style>
      :root {
        --primary-color: #2c3e50;
        --secondary-color: #3498db;
        --success-color: #27ae60;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
        --light-bg: #f8f9fa;
        --dark-bg: #2c3e50;
        --border-color: #dee2e6;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      }

      .header {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        padding: 30px 40px;
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><polygon points="50,0 100,50 50,100 0,50" fill="white"/></svg>');
        background-size: 80px 80px;
      }

      .header h1 {
        margin: 0;
        font-size: 2.5em;
        font-weight: 300;
        position: relative;
        z-index: 1;
      }

      .header p {
        margin: 10px 0 0 0;
        opacity: 0.9;
        font-size: 1.1em;
        position: relative;
        z-index: 1;
      }

      .nav {
        display: flex;
        gap: 5px;
        padding: 20px 40px;
        background: var(--light-bg);
        border-bottom: 1px solid var(--border-color);
        flex-wrap: wrap;
      }

      .nav-btn {
        padding: 12px 24px;
        background: white;
        color: var(--primary-color);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .nav-btn:hover {
        background: var(--secondary-color);
        color: white;
        border-color: var(--secondary-color);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
      }

      .nav-btn.active {
        background: var(--secondary-color);
        color: white;
        border-color: var(--secondary-color);
      }

      .content-area {
        background: white;
        padding: 30px 40px;
        min-height: 600px;
      }

      .section {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .section.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        border-left: 5px solid var(--secondary-color);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-card h3 {
        margin: 0 0 10px 0;
        color: #6c757d;
        font-size: 0.9em;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .stat-card .number {
        font-size: 2.5em;
        font-weight: bold;
        color: var(--secondary-color);
        margin: 0;
      }

      .entity-categories {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .category-btn {
        padding: 10px 20px;
        background: var(--light-bg);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .category-btn.active {
        background: var(--secondary-color);
        color: white;
        border-color: var(--secondary-color);
      }

      .entity-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
      }

      .entity-card {
        border: 1px solid var(--border-color);
        padding: 20px;
        border-radius: 10px;
        background: white;
        transition: all 0.3s ease;
        position: relative;
      }

      .entity-card:hover {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        transform: translateY(-5px);
      }

      .entity-type-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: 600;
      }

      .badge-person {
        background: #e3f2fd;
        color: #1976d2;
      }
      .badge-organization {
        background: #e8f5e8;
        color: #2e7d32;
      }
      .badge-location {
        background: #fff3e0;
        color: #f57c00;
      }
      .badge-event {
        background: #fce4ec;
        color: #c2185b;
      }

      .entity-card h3 {
        margin: 0 0 10px 0;
        color: var(--primary-color);
        font-size: 1.2em;
      }

      .entity-card p {
        color: #6c757d;
        margin-bottom: 15px;
        line-height: 1.5;
      }

      .actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 5px;
      }

      .btn-primary {
        background: var(--secondary-color);
        color: white;
      }

      .btn-primary:hover {
        background: #2980b9;
        transform: translateY(-2px);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #545b62;
        transform: translateY(-2px);
      }

      .btn-success {
        background: var(--success-color);
        color: white;
      }

      .btn-success:hover {
        background: #219653;
        transform: translateY(-2px);
      }

      .btn-danger {
        background: var(--danger-color);
        color: white;
      }

      .btn-danger:hover {
        background: #c0392b;
        transform: translateY(-2px);
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #6c757d;
      }

      .graph-container {
        height: 600px;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        background: white;
        margin-bottom: 20px;
      }

      .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .quick-action-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid var(--border-color);
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .quick-action-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .quick-action-card .icon {
        font-size: 2em;
        margin-bottom: 10px;
      }

      .search-box {
        margin-bottom: 20px;
      }

      .search-input {
        width: 100%;
        max-width: 400px;
        padding: 12px 20px;
        border: 2px solid var(--border-color);
        border-radius: 25px;
        font-size: 1em;
        transition: all 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .nav {
          flex-direction: column;
        }

        .entity-grid {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ›ï¸ æ ¡å²ç®¡ç†é¢æ¿</h1>
        <p>ç»Ÿä¸€ç®¡ç†ä¸­å¿ƒ - ç®¡ç†æ‰€æœ‰å®ä½“ã€å…³ç³»å’ŒçŸ¥è¯†å›¾è°±æ•°æ®</p>
      </div>

      <div class="nav">
        <button class="nav-btn active" onclick="showSection('dashboard')">
          ğŸ“Š ä»ªè¡¨æ¿
        </button>
        <button class="nav-btn" onclick="showSection('entities')">
          ğŸ‘¥ å®ä½“ç®¡ç†
        </button>
        <button class="nav-btn" onclick="showSection('relationships')">
          ğŸ”— å…³ç³»ç®¡ç†
        </button>
        <button class="nav-btn" onclick="showSection('graph')">
          ğŸ•¸ï¸ çŸ¥è¯†å›¾è°±
        </button>
        <button class="nav-btn" onclick="showSection('system')">
          âš™ï¸ ç³»ç»Ÿè®¾ç½®
        </button>
      </div>

      <div class="content-area">
        <!-- ä»ªè¡¨æ¿ -->
        <div id="dashboard" class="section active">
          <h2>ğŸ“ˆ ç³»ç»Ÿæ¦‚è§ˆ</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <h3>å®ä½“æ€»æ•°</h3>
              <p class="number" id="entity-count">--</p>
              <small>äººç‰©ã€åœ°ç‚¹ã€ç»„ç»‡ç­‰</small>
            </div>
            <div class="stat-card">
              <h3>å…³ç³»æ€»æ•°</h3>
              <p class="number" id="relationship-count">--</p>
              <small>å®ä½“é—´çš„å…³è”å…³ç³»</small>
            </div>
            <div class="stat-card">
              <h3>æ–‡æ¡£æ€»æ•°</h3>
              <p class="number" id="document-count">--</p>
              <small>å·²å¤„ç†çš„æ–‡æ¡£æ•°é‡</small>
            </div>
            <div class="stat-card">
              <h3>çŸ¥è¯†å›¾è°±</h3>
              <p class="number" id="graph-count">--</p>
              <small>å›¾è°±èŠ‚ç‚¹æ•°é‡</small>
            </div>
          </div>

          <h3>ğŸš€ å¿«é€Ÿæ“ä½œ</h3>
          <div class="quick-actions">
            <div class="quick-action-card" onclick="showSection('entities')">
              <div class="icon">ğŸ‘¥</div>
              <h4>ç®¡ç†å®ä½“</h4>
              <p>æ·»åŠ ã€ç¼–è¾‘å’ŒæŸ¥çœ‹æ‰€æœ‰å®ä½“</p>
            </div>
            <div
              class="quick-action-card"
              onclick="showSection('relationships')"
            >
              <div class="icon">ğŸ”—</div>
              <h4>ç®¡ç†å…³ç³»</h4>
              <p>åˆ›å»ºå’Œç¼–è¾‘å®ä½“é—´å…³ç³»</p>
            </div>
            <div class="quick-action-card" onclick="showSection('graph')">
              <div class="icon">ğŸ•¸ï¸</div>
              <h4>çŸ¥è¯†å›¾è°±</h4>
              <p>å¯è§†åŒ–æŸ¥çœ‹çŸ¥è¯†å›¾è°±</p>
            </div>
            <div
              class="quick-action-card"
              onclick="window.open('/admin/', '_blank')"
            >
              <div class="icon">âš™ï¸</div>
              <h4>é«˜çº§ç®¡ç†</h4>
              <p>Djangoç®¡ç†åå°</p>
            </div>
          </div>

          <div
            style="
              margin-top: 30px;
              padding: 20px;
              background: var(--light-bg);
              border-radius: 10px;
            "
          >
            <h4>ğŸ“‹ æœ€è¿‘æ´»åŠ¨</h4>
            <div id="recent-activities">
              <p style="color: #6c757d; text-align: center">åŠ è½½ä¸­...</p>
            </div>
          </div>
        </div>

        <!-- å®ä½“ç®¡ç† -->
        <div id="entities" class="section">
          <h2>ğŸ‘¥ å®ä½“ç®¡ç†</h2>

          <div class="search-box">
            <input
              type="text"
              id="entity-search"
              class="search-input"
              placeholder="ğŸ” æœç´¢å®ä½“åç§°..."
              onkeyup="filterEntities()"
            />
          </div>

          <div class="entity-categories">
            <button
              class="category-btn active"
              onclick="filterByCategory('all')"
            >
              å…¨éƒ¨
            </button>
            <button class="category-btn" onclick="filterByCategory('person')">
              ğŸ‘¤ äººç‰©
            </button>
            <button class="category-btn" onclick="filterByCategory('location')">
              ğŸ“ åœ°ç‚¹
            </button>
            <button
              class="category-btn"
              onclick="filterByCategory('organization')"
            >
              ğŸ¢ ç»„ç»‡
            </button>
            <button class="category-btn" onclick="filterByCategory('event')">
              ğŸ¯ äº‹ä»¶
            </button>
          </div>

          <div class="actions" style="margin-bottom: 20px">
            <button class="btn btn-primary" onclick="loadEntities()">
              ğŸ”„ åˆ·æ–°åˆ—è¡¨
            </button>
            <button class="btn btn-success" onclick="showCreateEntityModal()">
              â• æ·»åŠ å®ä½“
            </button>
            <button
              class="btn btn-secondary"
              onclick="window.open('/api/entities/', '_blank')"
            >
              ğŸ”— APIæŸ¥çœ‹
            </button>
          </div>

          <div id="entities-list" class="loading">æ­£åœ¨åŠ è½½å®ä½“æ•°æ®...</div>
        </div>

        <!-- å…³ç³»ç®¡ç† -->
        <div id="relationships" class="section">
          <h2>ğŸ”— å…³ç³»ç®¡ç†</h2>

          <div class="search-box">
            <input
              type="text"
              id="relationship-search"
              class="search-input"
              placeholder="ğŸ” æœç´¢å…³ç³»..."
              onkeyup="filterRelationships()"
            />
          </div>

          <div class="actions" style="margin-bottom: 20px">
            <button class="btn btn-primary" onclick="loadRelationships()">
              ğŸ”„ åˆ·æ–°åˆ—è¡¨
            </button>
            <button
              class="btn btn-success"
              onclick="showCreateRelationshipModal()"
            >
              â• æ·»åŠ å…³ç³»
            </button>
            <button
              class="btn btn-secondary"
              onclick="window.open('/api/relationships/', '_blank')"
            >
              ğŸ”— APIæŸ¥çœ‹
            </button>
          </div>

          <div id="relationships-list" class="loading">æ­£åœ¨åŠ è½½å…³ç³»æ•°æ®...</div>
        </div>

        <!-- çŸ¥è¯†å›¾è°± -->
        <div id="graph" class="section">
          <h2>ğŸ•¸ï¸ çŸ¥è¯†å›¾è°±å¯è§†åŒ–</h2>

          <div class="actions" style="margin-bottom: 20px">
            <button class="btn btn-primary" onclick="loadFullGraph()">
              ğŸ”„ åˆ·æ–°å›¾è°±
            </button>
            <button class="btn btn-success" onclick="showGraphSettings()">
              âš™ï¸ å›¾è°±è®¾ç½®
            </button>
          </div>

          <div class="graph-container" id="knowledge-graph-container">
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100%;
                color: #6c757d;
                flex-direction: column;
              "
            >
              <div style="font-size: 4em; margin-bottom: 20px">ğŸ•¸ï¸</div>
              <h3>çŸ¥è¯†å›¾è°±å¯è§†åŒ–</h3>
              <p style="margin-bottom: 20px">æ­£åœ¨åŠ è½½çŸ¥è¯†å›¾è°±æ•°æ®...</p>
              <button class="btn btn-primary" onclick="initKnowledgeGraph()">
                åˆå§‹åŒ–å›¾è°±
              </button>
            </div>
          </div>

          <div style="margin-top: 20px">
            <button
              class="btn btn-secondary"
              onclick="window.open('/api/knowledge-graph/', '_blank')"
            >
              ğŸ“Š æŸ¥çœ‹å®Œæ•´å›¾è°±æ•°æ®
            </button>
          </div>
        </div>

        <!-- ç³»ç»Ÿè®¾ç½® -->
        <div id="system" class="section">
          <h2>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h2>

          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
              gap: 20px;
              margin-top: 20px;
            "
          >
            <div
              style="
                padding: 20px;
                background: var(--light-bg);
                border-radius: 10px;
              "
            >
              <h4>ğŸ”§ ç³»ç»Ÿä¿¡æ¯</h4>
              <div id="system-info">
                <p>æ­£åœ¨åŠ è½½ç³»ç»Ÿä¿¡æ¯...</p>
              </div>
            </div>

            <div
              style="
                padding: 20px;
                background: var(--light-bg);
                border-radius: 10px;
              "
            >
              <h4>ğŸ› ï¸ ç»´æŠ¤å·¥å…·</h4>
              <div
                class="actions"
                style="flex-direction: column; align-items: start; gap: 10px"
              >
                <button class="btn btn-primary" onclick="clearCache()">
                  ğŸ§¹ æ¸…ç†ç¼“å­˜
                </button>
                <button class="btn btn-secondary" onclick="rebuildIndex()">
                  ğŸ”„ é‡å»ºç´¢å¼•
                </button>
                <button class="btn btn-danger" onclick="backupData()">
                  ğŸ’¾ æ•°æ®å¤‡ä»½
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div
      id="modal-container"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      "
    >
      <div
        id="modal-content"
        style="
          background: white;
          padding: 30px;
          border-radius: 10px;
          max-width: 500px;
          width: 90%;
          max-height: 80vh;
          overflow-y: auto;
        "
      ></div>
    </div>

    <script>
      // æ˜¾ç¤ºæŒ‡å®šéƒ¨åˆ†
      function showSection(sectionId) {
        // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
        document.querySelectorAll(".nav-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.classList.add("active");

        // æ˜¾ç¤ºå¯¹åº”å†…å®¹
        document.querySelectorAll(".section").forEach((section) => {
          section.classList.remove("active");
        });
        document.getElementById(sectionId).classList.add("active");

        // æ ¹æ®å½“å‰éƒ¨åˆ†åŠ è½½æ•°æ®
        switch (sectionId) {
          case "entities":
            loadEntities();
            break;
          case "relationships":
            loadRelationships();
            break;
          case "graph":
            initKnowledgeGraph();
            break;
          case "system":
            loadSystemInfo();
            break;
          default:
            loadStats();
            loadRecentActivities();
        }
      }

      // åŠ è½½ç»Ÿè®¡æ•°æ®
      async function loadStats() {
        try {
          const [entitiesRes, relationshipsRes, documentsRes, graphRes] =
            await Promise.all([
              fetch("/api/entities/"),
              fetch("/api/relationships/"),
              fetch("/api/documents/"),
              fetch("/api/knowledge-graph/"),
            ]);

          const entities = await entitiesRes.json();
          const relationships = await relationshipsRes.json();
          const documents = await documentsRes.json();
          const graph = await graphRes.json();

          document.getElementById("entity-count").textContent =
            entities.length || entities.count || 0;
          document.getElementById("relationship-count").textContent =
            relationships.length || relationships.count || 0;
          document.getElementById("document-count").textContent =
            documents.length || documents.count || 0;
          document.getElementById("graph-count").textContent = graph.nodes
            ? graph.nodes.length
            : 0;
        } catch (error) {
          console.error("åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:", error);
          document.getElementById("entity-count").textContent = "é”™è¯¯";
          document.getElementById("relationship-count").textContent = "é”™è¯¯";
          document.getElementById("document-count").textContent = "é”™è¯¯";
          document.getElementById("graph-count").textContent = "é”™è¯¯";
        }
      }

      // åŠ è½½æœ€è¿‘æ´»åŠ¨
      async function loadRecentActivities() {
        const container = document.getElementById("recent-activities");
        try {
          // è¿™é‡Œå¯ä»¥è°ƒç”¨APIè·å–æœ€è¿‘æ´»åŠ¨ï¼Œæš‚æ—¶ç”¨æ¨¡æ‹Ÿæ•°æ®
          const activities = [
            {
              action: "åˆ›å»º",
              target: "æ–°å®ä½“",
              time: "2åˆ†é’Ÿå‰",
              user: "ç®¡ç†å‘˜",
            },
            {
              action: "æ›´æ–°",
              target: "å…³ç³»æ•°æ®",
              time: "5åˆ†é’Ÿå‰",
              user: "ç³»ç»Ÿ",
            },
            {
              action: "å¤„ç†",
              target: "æ–‡æ¡£ä¸Šä¼ ",
              time: "10åˆ†é’Ÿå‰",
              user: "ç®¡ç†å‘˜",
            },
          ];

          container.innerHTML = activities
            .map(
              (activity) => `
                    <div style="padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: between; align-items: center;">
                        <div>
                            <strong>${activity.user}</strong> ${activity.action}äº† <strong>${activity.target}</strong>
                        </div>
                        <small style="color: #6c757d;">${activity.time}</small>
                    </div>
                `
            )
            .join("");
        } catch (error) {
          container.innerHTML =
            '<p style="color: #6c757d;">æ— æ³•åŠ è½½æœ€è¿‘æ´»åŠ¨</p>';
        }
      }

      // åŠ è½½å®ä½“åˆ—è¡¨
      async function loadEntities() {
        const entitiesList = document.getElementById("entities-list");
        entitiesList.innerHTML =
          '<div class="loading">æ­£åœ¨åŠ è½½å®ä½“æ•°æ®...</div>';

        try {
          const response = await fetch("/api/entities/");
          const entities = await response.json();

          if (entities.length === 0) {
            entitiesList.innerHTML = '<div class="loading">æš‚æ— å®ä½“æ•°æ®</div>';
            return;
          }

          // ä¿å­˜å®ä½“æ•°æ®ç”¨äºè¿‡æ»¤
          window.allEntities = entities;

          displayEntities(entities);
        } catch (error) {
          console.error("åŠ è½½å®ä½“åˆ—è¡¨å¤±è´¥:", error);
          entitiesList.innerHTML =
            '<div class="loading">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
        }
      }

      // æ˜¾ç¤ºå®ä½“åˆ—è¡¨
      function displayEntities(entities) {
        const entitiesList = document.getElementById("entities-list");

        entitiesList.innerHTML = `
                <div class="entity-grid">
                    ${entities
                      .map(
                        (entity) => `
                        <div class="entity-card" data-type="${
                          entity.entity_type
                        }">
                            <span class="entity-type-badge badge-${
                              entity.entity_type
                            }">
                                ${getEntityTypeLabel(entity.entity_type)}
                            </span>
                            <h3>${entity.name}</h3>
                            <p>${
                              entity.description
                                ? entity.description.substring(0, 100) +
                                  (entity.description.length > 100 ? "..." : "")
                                : "æš‚æ— æè¿°"
                            }</p>
                            <div class="actions">
                                <button class="btn btn-primary" onclick="viewEntityDetail(${
                                  entity.id
                                })">
                                    ğŸ‘ï¸ æŸ¥çœ‹è¯¦æƒ…
                                </button>
                                <button class="btn btn-success" onclick="viewEntitySubgraph(${
                                  entity.id
                                })">
                                    ğŸ•¸ï¸ æŸ¥çœ‹å­å›¾
                                </button>
                                <button class="btn btn-secondary" onclick="editEntity(${
                                  entity.id
                                })">
                                    âœï¸ ç¼–è¾‘
                                </button>
                            </div>
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;
      }

      // è·å–å®ä½“ç±»å‹æ ‡ç­¾
      function getEntityTypeLabel(type) {
        const typeMap = {
          person: "äººç‰©",
          organization: "ç»„ç»‡",
          location: "åœ°ç‚¹",
          event: "äº‹ä»¶",
          time: "æ—¶é—´",
        };
        return typeMap[type] || type;
      }

      // æŒ‰ç±»åˆ«è¿‡æ»¤å®ä½“
      function filterByCategory(category) {
        // æ›´æ–°ç±»åˆ«æŒ‰é’®çŠ¶æ€
        document.querySelectorAll(".category-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.classList.add("active");

        if (!window.allEntities) return;

        let filteredEntities = window.allEntities;
        if (category !== "all") {
          filteredEntities = window.allEntities.filter(
            (entity) => entity.entity_type === category
          );
        }

        displayEntities(filteredEntities);
      }

      // æœç´¢è¿‡æ»¤å®ä½“
      function filterEntities() {
        const searchTerm = document
          .getElementById("entity-search")
          .value.toLowerCase();
        if (!window.allEntities) return;

        const filteredEntities = window.allEntities.filter(
          (entity) =>
            entity.name.toLowerCase().includes(searchTerm) ||
            (entity.description &&
              entity.description.toLowerCase().includes(searchTerm))
        );

        displayEntities(filteredEntities);
      }

      // åŠ è½½å…³ç³»åˆ—è¡¨
      async function loadRelationships() {
        const relationshipsList = document.getElementById("relationships-list");
        relationshipsList.innerHTML =
          '<div class="loading">æ­£åœ¨åŠ è½½å…³ç³»æ•°æ®...</div>';

        try {
          const response = await fetch("/api/relationships/");
          const relationships = await response.json();

          if (relationships.length === 0) {
            relationshipsList.innerHTML =
              '<div class="loading">æš‚æ— å…³ç³»æ•°æ®</div>';
            return;
          }

          // ä¿å­˜å…³ç³»æ•°æ®ç”¨äºè¿‡æ»¤
          window.allRelationships = relationships;

          displayRelationships(relationships);
        } catch (error) {
          console.error("åŠ è½½å…³ç³»åˆ—è¡¨å¤±è´¥:", error);
          relationshipsList.innerHTML =
            '<div class="loading">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
        }
      }

      // æ˜¾ç¤ºå…³ç³»åˆ—è¡¨
      function displayRelationships(relationships) {
        const relationshipsList = document.getElementById("relationships-list");

        relationshipsList.innerHTML = relationships
          .map(
            (rel) => `
                <div class="entity-card">
                    <h3>
                        <span style="color: var(--primary-color);">${
                          rel.source_entity_name
                        }</span>
                        <span style="color: var(--secondary-color); margin: 0 10px;">â†’ ${
                          rel.relationship_type
                        } â†’</span>
                        <span style="color: var(--primary-color);">${
                          rel.target_entity_name
                        }</span>
                    </h3>
                    <p>${rel.description || "æš‚æ— æè¿°"}</p>
                    <div style="display: flex; justify-content: space-between; color: #6c757d; font-size: 0.9em; margin-bottom: 15px;">
                        <span>ç½®ä¿¡åº¦: ${rel.confidence || "1.0"}</span>
                        <span>ID: ${rel.id}</span>
                    </div>
                    <div class="actions">
                        <button class="btn btn-primary" onclick="viewRelationshipDetail(${
                          rel.id
                        })">
                            ğŸ‘ï¸ æŸ¥çœ‹è¯¦æƒ…
                        </button>
                        <button class="btn btn-secondary" onclick="editRelationship(${
                          rel.id
                        })">
                            âœï¸ ç¼–è¾‘
                        </button>
                        <button class="btn btn-danger" onclick="deleteRelationship(${
                          rel.id
                        })">
                            ğŸ—‘ï¸ åˆ é™¤
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // æœç´¢è¿‡æ»¤å…³ç³»
      function filterRelationships() {
        const searchTerm = document
          .getElementById("relationship-search")
          .value.toLowerCase();
        if (!window.allRelationships) return;

        const filteredRelationships = window.allRelationships.filter(
          (rel) =>
            rel.source_entity_name.toLowerCase().includes(searchTerm) ||
            rel.target_entity_name.toLowerCase().includes(searchTerm) ||
            rel.relationship_type.toLowerCase().includes(searchTerm)
        );

        displayRelationships(filteredRelationships);
      }

      // æŸ¥çœ‹å®ä½“è¯¦æƒ…
      function viewEntityDetail(entityId) {
        window.open(`/api/entities/${entityId}/`, "_blank");
      }

      // æŸ¥çœ‹å®ä½“å­å›¾
      function viewEntitySubgraph(entityId) {
        window.open(`/api/entity-subgraph/${entityId}/`, "_blank");
      }

      // æŸ¥çœ‹å…³ç³»è¯¦æƒ…
      function viewRelationshipDetail(relationshipId) {
        window.open(`/api/relationships/${relationshipId}/`, "_blank");
      }

      // åˆå§‹åŒ–çŸ¥è¯†å›¾è°±
      function initKnowledgeGraph() {
        const container = document.getElementById("knowledge-graph-container");
        container.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #6c757d; flex-direction: column;">
                    <div style="font-size: 3em; margin-bottom: 20px">ğŸ•¸ï¸</div>
                    <h3>çŸ¥è¯†å›¾è°±å¯è§†åŒ–</h3>
                    <p style="margin-bottom: 20px;">å¯ä»¥é›†æˆD3.jsæˆ–Echartsç­‰å¯è§†åŒ–åº“</p>
                    <div class="actions">
                        <button class="btn btn-primary" onclick="window.open('/api/knowledge-graph/', '_blank')">
                            ğŸ“Š æŸ¥çœ‹å®Œæ•´å›¾è°±æ•°æ®
                        </button>
                    </div>
                </div>
            `;
      }

      // åŠ è½½ç³»ç»Ÿä¿¡æ¯
      async function loadSystemInfo() {
        const systemInfo = document.getElementById("system-info");
        try {
          // æ¨¡æ‹Ÿç³»ç»Ÿä¿¡æ¯
          systemInfo.innerHTML = `
                    <div style="line-height: 2;">
                        <div><strong>ç³»ç»Ÿç‰ˆæœ¬:</strong> æ ¡å²ç®¡ç†ç³»ç»Ÿ v1.0</div>
                        <div><strong>æ•°æ®åº“:</strong> SQLite / Neo4j</div>
                        <div><strong>åç«¯æ¡†æ¶:</strong> Django 5.2</div>
                        <div><strong>å‰ç«¯æ¡†æ¶:</strong> Vue 3</div>
                        <div><strong>æœåŠ¡å™¨:</strong> å¼€å‘æœåŠ¡å™¨</div>
                        <div><strong>æœ€åæ›´æ–°:</strong> ${new Date().toLocaleString()}</div>
                    </div>
                `;
        } catch (error) {
          systemInfo.innerHTML = "<p>æ— æ³•åŠ è½½ç³»ç»Ÿä¿¡æ¯</p>";
        }
      }

      // å·¥å…·å‡½æ•°
      function clearCache() {
        alert("ç¼“å­˜æ¸…ç†åŠŸèƒ½");
      }

      function rebuildIndex() {
        alert("é‡å»ºç´¢å¼•åŠŸèƒ½");
      }

      function backupData() {
        alert("æ•°æ®å¤‡ä»½åŠŸèƒ½");
      }

      function showCreateEntityModal() {
        alert("åˆ›å»ºå®ä½“æ¨¡æ€æ¡†");
      }

      function showCreateRelationshipModal() {
        alert("åˆ›å»ºå…³ç³»æ¨¡æ€æ¡†");
      }

      function showGraphSettings() {
        alert("å›¾è°±è®¾ç½®");
      }

      function editEntity(id) {
        alert("ç¼–è¾‘å®ä½“: " + id);
      }

      function editRelationship(id) {
        alert("ç¼–è¾‘å…³ç³»: " + id);
      }

      function deleteRelationship(id) {
        if (confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå…³ç³»å—ï¼Ÿ")) {
          alert("åˆ é™¤å…³ç³»: " + id);
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", function () {
        loadStats();
        loadRecentActivities();
      });
    </script>
  </body>
</html>
